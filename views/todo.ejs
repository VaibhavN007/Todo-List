<html>
<head>
	<% include ./partials/head %>
	<link rel="stylesheet" href="/stylesheets/todo.css">
</head>
<body>
	<% include partials/header %>
<center>
	<div class="container">
		
		<ul class="list-group">
			<li class="list-group-item">
				<form class="add_newtask_form" method="post">
					<div class="form-group">
						<input type="text" class="form-control" id="newTask" name="task" placeholder="Add new Task">
						<button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span></button>
					</div>
				</form>
			</li>
			<li class="list-group-item">
				Lorem ipsum dolor sit amet
				<span class="glyphicon glyphicon-trash"></span>
				<span class="glyphicon glyphicon-ok"></span>
			</li>
			<li class="list-group-item">
				consectetur adipisicing elit
				<span class="glyphicon glyphicon-trash"></span>
				<span class="glyphicon glyphicon-ok"></span>
			</li>
			<li class="list-group-item">
				Similique ipsam vero provident
				<span class="glyphicon glyphicon-trash"></span>
				<span class="glyphicon glyphicon-ok"></span>
			</li>
			<li class="list-group-item">
				eum eligendi blanditiis ex explicabo 
				<span class="glyphicon glyphicon-trash"></span>
				<span class="glyphicon glyphicon-ok"></span>
			</li>
			<li class="list-group-item">
				vitae nostrum facilis
				<span class="glyphicon glyphicon-trash"></span>
				<span class="glyphicon glyphicon-ok"></span>
			</li>
		</ul>

	</div>
</center>

<script>

	var form = document.querySelector('.add_newtask_form');

	form.addEventListener('submit', function(e) {
		e.preventDefault();
		
		var obj = getFormData();
		
		console.log(obj);

		addTask(obj);
		
		form.reset();

		return false;
	});

	function getFormData()
	{
		var elements = form.elements;

		var formData ={};

		for(var i = 0 ; i < elements.length ; i++){
			var item = elements.item(i);
			if(item.name!="" && item.value!="")
				formData[item.name] = item.value;
		}
		return formData;
	}
	
	function addTask(newTask)
	{
		var xhttp = new XMLHttpRequest();

		xhttp.open("POST", "http://localhost:3000/todo/add", true);
		xhttp.setRequestHeader('Content-Type', 'application/json');

		xhttp.onreadystatechange = function()
		{
			if (this.readyState == 4 && this.status == 200)
			{
				console.log(this.responseText);
				// document.getElementById("demo").innerHTML = this.responseText;
			}
		};

		console.log("sending", JSON.stringify(newTask));
		
		xhttp.send(JSON.stringify(newTask));
	}
</script>

</body>
</html>